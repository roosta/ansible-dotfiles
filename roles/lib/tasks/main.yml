---
- name: stat lib path
  stat: path="~/lib"
  register: existing_lib_path

- name: create library local path
  file: path={{ library_local_path }} state=directory mode=0755
  when: existing_lib_path.stat.exists == false

- name: clone or update libraries with no action
  git:
    repo: "{{ item.repo }}"
    dest: "{{ library_local_path }}/{{ item.dest }}"
  with_items:
    - { repo: "https://github.com/fidian/ansi",
    dest: "~/lib/ansi" }
    - { repo: "https://github.com/iye/lightsOn",
    dest: "~/lib/lightsOn" }

- name: clone xkblayout-state
  git:
    repo: "https://github.com/nonpop/xkblayout-state"
    dest: "{{ library_local_path }}"
  notify:
    - build xkblayout-state

- name: clone sack
  git:
    repo: "https://github.com/sampson-chen/sack"
    dest: "~/lib/sack"
  notify:
    - install sack

- name: clone lein repls
  git:
    repo: "https://github.com/franks42/lein-repls"
    dest: "~/lib/lein-repls"
  notify:
    - setup cljsh

- name: symlink local binaries
  file: src={{ item.src }} dest={{ item.dest }} state=link
  with_items:
    - { src: "{{ home }}/lib/ansi/ansi", dest: "~/bin/ansi" }
    - { src: "{{ home }}/lib/lightsOn/lightsOn.sh", dest: "~/bin/lightsOn" }
    - { src: "{{ home }}/lib/xkblayout-state/xkblayout-state", dest: "~/bin/xkblayout-state" }
    - { src: "{{ home }}/lib/lein-repls/bin/cljsh", dest: "~/bin/cljsh" }
  tags:
    - bin
    - init
